# Use a imagem oficial do PHP com Apache
FROM php:8.2-apache

# Configuração CRÍTICA do Apache
RUN echo "<Directory /var/www/html/public>" > /etc/apache2/conf-available/public.conf && \
    echo "    Options FollowSymLinks" >> /etc/apache2/conf-available/public.conf && \
    echo "    AllowOverride All" >> /etc/apache2/conf-available/public.conf && \
    echo "    Require all granted" >> /etc/apache2/conf-available/public.conf && \
    echo "</Directory>" >> /etc/apache2/conf-available/public.conf && \
    a2enconf public && \
    a2enmod rewrite

# Cria a estrutura de diretórios
RUN mkdir -p /var/www/html/public

# Copia APENAS a pasta pública
COPY ./public/ /var/www/html/public/

# Configura permissões (otimizado para Windows)
RUN chown -R www-data:www-data /var/www/html && \
    find /var/www/html -type d -exec chmod 755 {} \; && \
    find /var/www/html -type f -exec chmod 644 {} \;

# Porta exposta
EXPOSE 80

# Comando de inicialização
CMD ["apache2-foreground"]
